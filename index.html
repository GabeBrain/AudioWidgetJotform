<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>URL Echo Widget</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 1rem; }
    label, input { display: block; width: 100%; }
    input { margin-top: .25rem; padding: .5rem; }
  </style>
</head>
<body>
  <label>
    URL to send back:
    <input id="urlInput" placeholder="https://example.com" />
  </label>

  <script>
    const input = document.getElementById('urlInput');

    function trySend(value) {
      if (!window.JFCustomWidget) return;
      window.JFCustomWidget.sendData({
        valid: !!value,
        value
      });
    }

    // Retry until JFCustomWidget exists
    const handshake = setInterval(() => {
      if (!window.JFCustomWidget) return;
      clearInterval(handshake);

      // Tell Jotform we're ready and set current value
      window.JFCustomWidget.subscribe('ready', function (msg) {
        input.value = msg?.value?.value || '';
        trySend(input.value);
      });

      // Acknowledge form submissions so the parent can continue
      window.JFCustomWidget.subscribe('submit', function () {
        const value = input.value.trim();
        window.JFCustomWidget.sendSubmit({
          valid: !!value,
          value
        });
      });

      // Push new value on change
      input.addEventListener('input', () => trySend(input.value.trim()));
    }, 50);
  </script>
</body>
</html>